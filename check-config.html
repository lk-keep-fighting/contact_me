<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase é…ç½®æ£€æŸ¥</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
    .error { background: #ffebee; border-color: #f44336; color: #c62828; }
    .success { background: #e8f5e8; border-color: #4caf50; color: #2e7d32; }
    .warning { background: #fff3e0; border-color: #ff9800; color: #ef6c00; }
    .info { background: #e3f2fd; border-color: #2196f3; color: #1976d2; }
    .code { background: #f4f4f4; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
    h1 { color: #333; text-align: center; }
    h2 { color: #555; border-bottom: 2px solid #0ea5e9; padding-bottom: 10px; }
    button { padding: 10px 20px; background: #0ea5e9; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
    button:hover { background: #0284c7; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ Supabase é…ç½®æ£€æŸ¥å·¥å…·</h1>
    
    <div class="section info">
      <h2>å½“å‰ç¯å¢ƒä¿¡æ¯</h2>
      <div class="code" id="currentInfo">æ­£åœ¨æ£€æµ‹...</div>
    </div>

    <div class="section warning">
      <h2>âš ï¸ é—®é¢˜è¯Šæ–­ï¼šéªŒè¯é‚®ä»¶è·³è½¬é”™è¯¯</h2>
      <p><strong>é—®é¢˜ï¼š</strong>æ³¨å†ŒéªŒè¯é‚®ä»¶é“¾æ¥è·³è½¬åˆ° localhost:3000</p>
      <p><strong>åº”è¯¥è·³è½¬åˆ°ï¼š</strong>https://contact-me.dev/</p>
      <p><strong>åŸå› ï¼š</strong>Supabaseé¡¹ç›®çš„Site URLé…ç½®é”™è¯¯</p>
    </div>

    <div class="section error">
      <h2>ğŸš¨ éœ€è¦ç«‹å³ä¿®å¤çš„é…ç½®</h2>
      
      <h3>1. åœ¨Supabase Dashboardä¸­ä¿®å¤Site URL</h3>
      <ol>
        <li>ç™»å½• <a href="https://app.supabase.com" target="_blank">Supabase Dashboard</a></li>
        <li>é€‰æ‹©ä½ çš„é¡¹ç›®</li>
        <li>å¯¼èˆªåˆ° <strong>Settings â†’ Authentication</strong></li>
        <li>åœ¨ <strong>"Site URL"</strong> å­—æ®µä¸­ï¼Œå°†ï¼š</li>
        <div class="code">âŒ å½“å‰å€¼: http://localhost:3000</div>
        <div class="code">âœ… æ”¹ä¸º: https://contact-me.dev</div>
      </ol>

      <h3>2. é…ç½®å…è®¸çš„é‡å®šå‘URL</h3>
      <p>åœ¨åŒä¸€é¡µé¢çš„ <strong>"Additional Redirect URLs"</strong> éƒ¨åˆ†æ·»åŠ ï¼š</p>
      <div class="code">
        https://contact-me.dev/**<br>
        https://contact-me.dev/dashboard.html<br>
        https://contact-me.dev/login.html<br>
        https://contact-me.dev/redirect.html
      </div>
    </div>

    <div class="section">
      <h2>ğŸ§ª é…ç½®éªŒè¯æµ‹è¯•</h2>
      <button onclick="testCurrentDomain()">æ£€æµ‹å½“å‰åŸŸå</button>
      <button onclick="testSupabaseConfig()">æ£€æµ‹Supabaseé…ç½®</button>
      <button onclick="testAuthFlow()">æµ‹è¯•è®¤è¯æµç¨‹</button>
      
      <div id="testResults"></div>
    </div>

    <div class="section success">
      <h2>âœ… ä¿®å¤å®Œæˆåçš„éªŒè¯æ­¥éª¤</h2>
      <ol>
        <li>åœ¨Supabaseä¸­ä¿å­˜æ–°çš„é…ç½®</li>
        <li>ç­‰å¾…1-2åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ</li>
        <li>æ³¨å†Œä¸€ä¸ªæ–°çš„æµ‹è¯•è´¦å·</li>
        <li>æ£€æŸ¥éªŒè¯é‚®ä»¶ä¸­çš„é“¾æ¥æ˜¯å¦æŒ‡å‘æ­£ç¡®çš„åŸŸå</li>
        <li>ç‚¹å‡»éªŒè¯é“¾æ¥ï¼Œç¡®è®¤èƒ½æ­£ç¡®è·³è½¬åˆ°ä½ çš„ç½‘ç«™</li>
      </ol>
    </div>
  </div>

  <script src="/js/config.js"></script>
  <script>
    const cfg = window.__APP_CONFIG__ || {};
    
    function updateCurrentInfo() {
      const info = `
å½“å‰é¡µé¢URL: ${window.location.href}
å½“å‰åŸŸå: ${window.location.hostname}
åè®®: ${window.location.protocol}
ç«¯å£: ${window.location.port || '(é»˜è®¤)'}

Supabaseé…ç½®:
- URL: ${cfg.supabaseUrl || 'æœªé…ç½®'}
- Key: ${cfg.supabaseKey ? cfg.supabaseKey.substring(0, 20) + '...' : 'æœªé…ç½®'}

æœŸæœ›çš„Site URL: https://contact-me.dev
      `;
      document.getElementById('currentInfo').textContent = info;
    }
    
    function log(message, type = 'info') {
      const results = document.getElementById('testResults');
      const div = document.createElement('div');
      div.className = `section ${type}`;
      div.innerHTML = `<p>${message}</p>`;
      results.appendChild(div);
    }
    
    function testCurrentDomain() {
      document.getElementById('testResults').innerHTML = '';
      
      const currentDomain = window.location.hostname;
      const expectedDomain = 'contact-me.dev';
      
      if (currentDomain === expectedDomain) {
        log('âœ… å½“å‰æ­£åœ¨æ­£ç¡®çš„ç”Ÿäº§åŸŸåä¸Šè®¿é—®', 'success');
      } else if (currentDomain === 'localhost' || currentDomain.includes('127.0.0.1')) {
        log('âš ï¸ å½“å‰åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œè¿™æ˜¯æ­£å¸¸çš„', 'warning');
      } else {
        log(`â“ å½“å‰åŸŸå: ${currentDomain}ï¼ŒæœŸæœ›åŸŸå: ${expectedDomain}`, 'info');
      }
    }
    
    async function testSupabaseConfig() {
      if (!cfg.supabaseUrl || !cfg.supabaseKey) {
        log('âŒ Supabaseé…ç½®ç¼ºå¤±ï¼Œæ— æ³•æµ‹è¯•', 'error');
        return;
      }
      
      try {
        const client = window.supabase?.createClient(cfg.supabaseUrl, cfg.supabaseKey);
        if (!client) {
          log('âŒ æ— æ³•åˆ›å»ºSupabaseå®¢æˆ·ç«¯', 'error');
          return;
        }
        
        // å°è¯•è·å–å½“å‰ä¼šè¯
        const { data: { session }, error } = await client.auth.getSession();
        
        if (error) {
          log(`âš ï¸ è®¤è¯æ£€æŸ¥å¤±è´¥: ${error.message}`, 'warning');
        } else {
          log('âœ… Supabaseè¿æ¥æ­£å¸¸', 'success');
          if (session) {
            log('âœ… å½“å‰æœ‰æ´»è·ƒçš„ç”¨æˆ·ä¼šè¯', 'success');
          } else {
            log('â„¹ï¸ å½“å‰æ²¡æœ‰ç”¨æˆ·ä¼šè¯ï¼ˆæœªç™»å½•ï¼‰', 'info');
          }
        }
      } catch (err) {
        log(`âŒ Supabaseæµ‹è¯•å¤±è´¥: ${err.message}`, 'error');
      }
    }
    
    async function testAuthFlow() {
      if (!cfg.supabaseUrl || !cfg.supabaseKey) {
        log('âŒ éœ€è¦Supabaseé…ç½®æ‰èƒ½æµ‹è¯•è®¤è¯æµç¨‹', 'error');
        return;
      }
      
      log('â„¹ï¸ è®¤è¯æµç¨‹æµ‹è¯•è¯´æ˜:', 'info');
      log('1. ç¡®ä¿å·²åœ¨Supabaseä¸­é…ç½®äº†æ­£ç¡®çš„Site URL', 'info');
      log('2. æ³¨å†Œä¸€ä¸ªæµ‹è¯•é‚®ç®±è´¦å·', 'info');
      log('3. æ£€æŸ¥éªŒè¯é‚®ä»¶ä¸­çš„é“¾æ¥æ˜¯å¦æŒ‡å‘ https://contact-me.dev', 'info');
      
      // æ˜¾ç¤ºå½“å‰è®¤è¯è®¾ç½®åº”è¯¥çš„æ ·å­
      const correctConfig = `
æ­£ç¡®çš„Supabaseè®¤è¯è®¾ç½®:

Site URL: https://contact-me.dev

Additional Redirect URLs:
- https://contact-me.dev/**
- https://contact-me.dev/dashboard.html
- https://contact-me.dev/login.html
- https://contact-me.dev/redirect.html
      `;
      
      log(correctConfig, 'info');
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ›´æ–°ä¿¡æ¯
    window.addEventListener('load', () => {
      updateCurrentInfo();
      
      // å¦‚æœæ²¡æœ‰åŠ è½½Supabaseåº“ï¼Œæ˜¾ç¤ºè­¦å‘Š
      if (!window.supabase) {
        setTimeout(() => {
          const script = document.createElement('script');
          script.src = 'https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js';
          document.head.appendChild(script);
        }, 1000);
      }
    });
  </script>
</body>
</html>